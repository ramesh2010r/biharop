const fs = require('fs');
const path = require('path');
const db = require('../config/database');

// CSV data embedded in script
const csvData = {
  'BJP': [
    ['बेतिया', 'श्रीमती रेणु देवी'],
    ['रक्सौल', 'श्री प्रमोद कुमार सिन्हा'],
    ['पिपरा', 'श्री श्यामबाबू प्रसाद यादव'],
    ['मधुबन', 'श्री राणा रणधीर सिंह'],
    ['मोतिहारी', 'श्री प्रमोद कुमार'],
    ['ढाका', 'श्री पवन जायसवाल'],
    ['रीगा', 'श्री बैद्यनाथ प्रसाद'],
    ['बथनाहा', 'श्री अनिल कुमार राम'],
    ['परिहार', 'श्रीमती गायत्री देवी'],
    ['सीतामढ़ी', 'श्री सुनील कुमार पिंटू'],
    ['बेनीपट्टी', 'श्री विनोद नारायण झा'],
    ['खजौली', 'श्री अरुण शंकर प्रसाद'],
    ['बिस्फी', 'श्री हरिभूषण ठाकुर बचौल'],
    ['राजनगर', 'श्री सुजीत पासवान'],
    ['झंझारपुर', 'श्री नीतीश मिश्रा'],
    ['छातापुर', 'श्री नीरज कुमार सिंह बबलू'],
    ['नरपतगंज', 'श्रीमती देवंती यादव'],
    ['फारबिसगंज', 'श्री विद्या सागर केसरी'],
    ['सिकटी', 'श्री विजय कुमार मंडल'],
    ['किशनगंज', 'श्रीमती स्वीटी सिंह'],
    ['बनमनखी', 'श्री कृष्ण कुमार ऋषि'],
    ['पूर्णिया', 'श्री विजय कुमार खेमका'],
    ['कटिहार', 'श्री तारकिशोर प्रसाद'],
    ['प्राणपुर', 'श्रीमती निशा सिंह'],
    ['कोढ़ा', 'श्रीमती कविता देवी'],
    ['सहरसा', 'श्री आलोक रंजन झा'],
    ['गौरा-बौराम', 'श्री सुजीत कुमार सिंह'],
    ['दरभंगा', 'श्री संजय सरावगी'],
    ['केवटी', 'श्री मुरारी मोहन झा'],
    ['जाले', 'श्री जिबेश कुमार मिश्रा'],
    ['औराई', 'श्रीमती रमा निषाद'],
    ['कुढ़नी', 'श्री केदार प्रसाद गुप्ता'],
    ['बरुराज', 'श्री अरुण कुमार सिंह'],
    ['साहेबगंज', 'श्री राजू कुमार सिंह'],
    ['बैकुण्ठपुर', 'श्री मिथिलेश तिवारी'],
    ['सिवान', 'श्री मंगल पांडेय'],
    ['दरौंदा', 'श्री कर्णजीत सिंह'],
    ['गोरेयाकोठी', 'श्री देवेश कांत सिंह'],
    ['तरैया', 'श्री जनक सिंह'],
    ['अमनौर', 'श्री कृष्ण कुमार मंटू'],
    ['हाजीपुर', 'श्री अवधेश सिंह'],
    ['लालगंज', 'श्री संजय कुमार सिंह'],
    ['पातेपुर', 'श्री लखेंद्र कुमार रौशन'],
    ['मोहिउद्दीननगर', 'श्री राजेश कुमार सिंह'],
    ['बछवारा', 'श्री सुरेंद्र मेहता'],
    ['तेघरा', 'श्री रजनीश कुमार'],
    ['बेगूसराय', 'श्री कुंदन कुमार'],
    ['भागलपुर', 'श्री रोहित पांडेय'],
    ['बांका', 'श्री राम नारायण मंडल'],
    ['कटोरिया', 'श्री पूरण लाल टुडू'],
    ['तारापुर', 'श्री सम्राट चौधरी'],
    ['मुंगेर', 'श्री कुमार प्रणय'],
    ['लखीसराय', 'श्री विजय कुमार सिन्हा'],
    ['बिहारशरीफ', 'डॉ सुनील कुमार'],
    ['दीघा', 'श्री संजीव चौरसिया'],
    ['बांकीपुर', 'श्री नितिन नबीन'],
    ['कुम्हरार', 'श्री संजय गुप्ता'],
    ['पटना साहिब', 'श्री रत्नेश कुशवाहा'],
    ['दानापुर', 'श्री रामकृपाल यादव'],
    ['बिक्रम', 'श्री सिद्धार्थ सौरव'],
    ['बड़हरा', 'श्री राघवेंद्र प्रताप सिंह'],
    ['आरा', 'श्री संजय सिंह "टाइगर"'],
    ['तरारी', 'श्री विशाल प्रशांत'],
    ['अरवल', 'श्री मनोज शर्मा'],
    ['औरंगाबाद', 'श्री त्रिविक्रम सिंह'],
    ['गुरुआ', 'श्री उपेंद्र दांगी'],
    ['गया शहर', 'डॉ प्रेम कुमार'],
    ['वजीरगंज', 'श्री बीरेंद्र सिंह'],
    ['हिसुआ', 'श्री अनिल सिंह'],
    ['वारसलीगंज', 'श्रीमती अरुणा देवी'],
    ['जमुई', 'सुश्री श्रेयसी सिंह'],
    ['अलीनगर', 'सुश्री मैथिली ठाकुर'],
    ['हयाघाट', 'श्री राम चंद्र प्रसाद'],
    ['मुजफ्फरपुर', 'श्री रंजन कुमार'],
    ['गायघाट', 'श्री सुभाष सिंह'],
    ['बनियापुर', 'श्री केदार नाथ सिंह'],
    ['छपरा', 'श्रीमती छोटी कुमारी'],
    ['सोनपुर', 'श्री विनय कुमार सिंह'],
    ['रोसड़ा', 'श्री बीरेंद्र कुमार'],
    ['बाढ़', 'डॉ. सियाराम सिंह'],
    ['अगिआंव', 'श्री महेश पासवान'],
    ['शाहपुर', 'श्री राकेश ओझा'],
    ['बक्सर', 'श्री आनंद मिश्रा, आईपीएस'],
    ['रामनगर', 'श्री नंद किशोर राम'],
    ['नरकटियागंज', 'श्री संजय पांडेय'],
    ['बगहा', 'श्री राम सिंह'],
    ['लौरिया', 'श्री विनय बिहारी'],
    ['नौतन', 'श्री नारायण प्रसाद'],
    ['चनपटिया', 'श्री उमाकांत सिंह'],
    ['हरसिद्धि', 'श्री कृष्णानंदन पासवान'],
    ['कल्याणपुर', 'श्री सचिंद्र प्रसाद सिंह'],
    ['चिरैया', 'श्री लालबाबू प्रसाद गुप्ता'],
    ['कोचाधामन', 'श्रीमती बीना देवी'],
    ['बायसी', 'श्री विनोद यादव'],
    ['राघोपुर', 'श्री सतीश कुमार यादव'],
    ['बिहपुर', 'श्री कुमार शैलेंद्र'],
    ['पीरपैंती', 'श्री मुरारी पासवान'],
    ['रामगढ़', 'श्री अशोक कुमार सिंह'],
    ['मोहनीया', 'श्रीमती संगीता कुमारी'],
    ['भभुआ', 'श्री भरत बिंद'],
    ['गोह', 'श्री रणवीर सिंह']
  ],
  'JDU': [
    ['आलम नगर', 'श्री नरेन्द्र सिंह'],
    ['बिहारीगंज', 'श्री निरंजन कुमार मेहता'],
    ['सिंहेश्वर', 'श्री रमेश ऋषिदेव'],
    ['मधेपुरा', 'श्रीमती कविता साह'],
    ['सोनबरसा', 'श्री रत्नेश कुमार'],
    ['महिषी', 'श्री गुंजेश्वर प्रसाद'],
    ['कुशेश्वरस्थान', 'श्री अतिरेक कुमार'],
    ['बेनीपुर', 'श्री विनय कुमार चौधरी'],
    ['दरभंगा ग्रामीण', 'श्री ईश्वर चौधरी'],
    ['बहादुरपुर', 'श्री मदन सहनी'],
    ['गायघाट', 'श्रीमती कोमल सिंह'],
    ['मीनापुर', 'श्री अजय कुशवाहा'],
    ['सकरा', 'श्री आदित्य कुशवाहा'],
    ['काँटी', 'श्री अजीत कुमार'],
    ['कुचायकोट', 'श्री अमरेन्द्र प्रताप सिंह'],
    ['भोरे', 'श्री सुनील कुमार'],
    ['हथुआ', 'श्री रामसेवक सिंह'],
    ['बरौली', 'श्री मंजीत सिंह'],
    ['जीरादेई', 'श्री भीष्म कुशवाहा'],
    ['रघुनाथपुर', 'श्री विकास कुमार सिंह उर्फ जीशु सिंह'],
    ['बड़हरिया', 'श्री इन्द्रदेव पटेल'],
    ['महराजगंज', 'श्री हेम नारायण साह'],
    ['एकमा', 'श्री धुमल सिंह'],
    ['माँझी', 'श्री रणधीर सिंह'],
    ['छपरा', 'श्री छोटे लाल राय'],
    ['वैशाली', 'श्री सिद्धार्थ पटेल'],
    ['राजापाकर', 'श्री महेन्द्र राम'],
    ['महनार', 'श्री उमेश सिंह कुशवाहा'],
    ['कल्याणपुर', 'श्री महेश्वर हजारी'],
    ['वारिसनगर', 'डॉ० माजिरीक हुसैन'],
    ['समस्तीपुर', 'श्रीमती अश्वनी कुमारी'],
    ['मोरवा', 'श्री विद्यासागर सिंह निषाद'],
    ['सराय रंजन', 'श्री विजय कुमार चौधरी'],
    ['विभूतिपुर', 'श्रीमती रवीना कुशवाहा'],
    ['हसनपुर', 'श्री राज कुमार राय'],
    ['चेरिया बरियारपुर', 'श्री अभिषेक कुमार'],
    ['मटिहानी', 'श्री राजकुमार सिंह'],
    ['अलौली', 'श्री रामचंद्र सदा'],
    ['खगड़िया', 'श्री बब्लू मंडल'],
    ['बेलदौर', 'श्री पन्ना लाल पटेल'],
    ['जमालपुर', 'श्री नचिकेत मंडल'],
    ['सूर्यगढ़ा', 'श्री रामानंद मंडल'],
    ['शेखपुरा', 'श्री रणधीर कुमार सोनी'],
    ['बरबीघा', 'डॉ० कुमार पुष्पम'],
    ['अस्थावाँ', 'श्री जितेन्द्र कुमार'],
    ['राजगीर', 'श्री कौशल किशोर'],
    ['इस्लामपुर', 'श्री रुहेल रंजन'],
    ['हिलसा', 'श्री कृष्ण मुरारी शरण उर्फ प्रेम मुखि'],
    ['नालन्दा', 'श्री श्रवण कुमार'],
    ['हरनौत', 'श्री हरिनारायण सिंह'],
    ['मोकामा', 'श्री अनंत सिंह'],
    ['फुलवारी', 'श्री श्याम रजक'],
    ['मसौढ़ी', 'श्री अरुण मांझी'],
    ['संदेश', 'श्री राधा चरण साह'],
    ['जगदीशपुर', 'श्री भगवान सिंह कुशवाहा'],
    ['डुमराँव', 'श्री राहुल सिंह'],
    ['राजपुर', 'श्री संतोष कुमार निराला'],
    ['वाल्मीकिनगर', 'श्री धीरेन्द्र प्रताप सिंह उर्फ रिंकू सिंह'],
    ['सिकटा', 'श्री शमबद वर्मा'],
    ['नरकटिया', 'श्री विशाल साह'],
    ['केसरिया', 'श्रीमती शालिनी मिश्रा'],
    ['शिवहर', 'श्रीमती श्वेता गुप्ता'],
    ['सुरसंड', 'श्री नागेन्द्र राउत'],
    ['रून्नीसैदपुर', 'श्री पंकज मिश्रा'],
    ['हरनाखी', 'श्री सुधांशु शेखर'],
    ['बाबूबरही', 'श्रीमती मीना कामत'],
    ['फुलपरास', 'श्रीमती शीला मंडल'],
    ['लौकहा', 'श्री सतीश साह'],
    ['निर्मली', 'श्री अनिरुद्ध प्रसाद यादव'],
    ['पिपरा', 'श्री राम विलास कामत'],
    ['सुपौल', 'श्री विजेन्द्र प्रसाद यादव'],
    ['त्रिवेणीगंज', 'श्रीमती सोनम रानी सरदार'],
    ['रानीगंज', 'श्री अचमित ऋषिदेव'],
    ['अररिया', 'श्रीमती शमृता अजीम'],
    ['जोकीहाट', 'जनाब मंजर आलम'],
    ['ठाकुरगंज', 'श्री गोपाल अग्रवाल'],
    ['अमीर', 'श्री सबा जफर'],
    ['रूपौली', 'श्री कलाधर मंडल'],
    ['धमदाहा', 'श्रीमती लेशी सिंह'],
    ['कदवा', 'श्री दुलालचन्द्र गोस्वामी'],
    ['मनिहारी', 'श्री शंभु सुमन'],
    ['बराड़ी', 'श्री विजय सिंह निषाद'],
    ['गोपालपुर', 'श्री बुलो मंडल'],
    ['सुल्तानगंज', 'डॉ० ललित नारायण मंडल'],
    ['कहलगांव', 'श्री शुमानंद मुकेश'],
    ['अमरपुर', 'श्री जयंत राज'],
    ['धोरैया', 'श्री मनीष कुमार'],
    ['बेलहर', 'श्री मनोज यादव'],
    ['चैनपुर', 'मो० जमा खान'],
    ['कराहर', 'श्री बशिष्ठ सिंह'],
    ['काराकाट', 'श्री महाबली सिंह'],
    ['नोखा', 'श्री नागेन्द्र चन्द्रवंशी'],
    ['कुरथी', 'श्री पप्पू कुमार वर्मा'],
    ['जहानाबाद', 'श्री चंद्रशेखर चन्द्रवंशी'],
    ['घोसी', 'श्री ऋतुराज कुमार'],
    ['नवीनगर', 'श्री चेतन आनंद'],
    ['रफीगंज', 'श्री प्रमोद कुमार सिंह'],
    ['बेलानगर', 'श्रीमती मनोरमा देवी'],
    ['नवादा', 'श्रीमती विभा देवी'],
    ['झाझा', 'श्री दामोदर रावत'],
    ['चकाई', 'श्री सुमित कुमार सिंह']
  ],
  'JAN_SURAJ': [
    ['वाल्मीकि नगर', 'डॉ. नारायण प्रसाद'],
    ['लौरिया', 'सुनील कुमार'],
    ['हरसिद्धि', 'अवधेश राम'],
    ['ढाका', 'डॉ. लाल बाबू प्रसाद'],
    ['सुरसंड', 'उषा किरण'],
    ['रुन्नीसैदपुर', 'विजय कुमार साह'],
    ['बेनीपट्टी', 'मोहम्मद परवेज़ आलम'],
    ['निर्मली', 'राम प्रकाश कुमार यादव'],
    ['सिकटी', 'राघिब बाबलू'],
    ['कोचाधामन', 'अबू अफ़फ़ान फारूक'],
    ['अमौर', 'अफ़रोज़ आलम'],
    ['बैसी', 'मोहम्मद शहनवाज़ आलम'],
    ['प्राणपुर', 'कुनाल निषाद उर्फ सोनू सिंह'],
    ['आलमनगर', 'सुभाष कुमार सुमन'],
    ['सहरसा', 'किशोर कुमार'],
    ['सिमरी बख्तियारपुर', 'सुरेन्द्र यादव'],
    ['महिषी', 'शमीम अख्तर'],
    ['दरभंगा ग्रामीण', 'शोएब खान'],
    ['दरभंगा', 'आर.के. मिश्रा'],
    ['केवटी', 'बिल्टू साहनी'],
    ['मीनापुर', 'तेज़ नारायण साहनी'],
    ['मुज़फ्फरपुर', 'डॉ. अमित कुमार दास'],
    ['गोपालगंज', 'डॉ. शशि शेखर सिन्हा'],
    ['भोरे', 'प्रीति किन्नर'],
    ['रघुनाथपुर', 'राहुल कुमार'],
    ['दरौंधा', 'सत्येन्द्र कुमार यादव'],
    ['मंझी', 'यदु वंश गिरी'],
    ['बनियापुर', 'श्रवण कुमार महतो'],
    ['छपरा', 'जय प्रकाश सिंह'],
    ['परसा', 'मुशाहिद महतो'],
    ['सोनपुर', 'चंदन लाल मेहता'],
    ['कल्याणपुर', 'राम बलाक पासवान'],
    ['मोरवा', 'जागृति ठाकुर'],
    ['मटिहानी', 'डॉ. अरुण कुमार'],
    ['बेगूसराय', 'सुरेन्द्र कुमार साहनी'],
    ['खगड़िया', 'जयंती पटेल'],
    ['बेलदौर', 'गजेन्द्र कुमार सिंह (निशाद)'],
    ['परबत्ता', 'विनय कुमार वरुण'],
    ['पीरपैंती', 'घनश्याम दास'],
    ['बेलहर', 'ब्रज किशोर पंडित'],
    ['अस्थावां', 'लता सिंह'],
    ['बिहार शरीफ', 'दिनेश कुमार'],
    ['नालंदा', 'कुमारी पूनम सिन्हा'],
    ['कुम्हरार', 'के. सी. सिन्हा'],
    ['आरा', 'डॉ. विजय कुमार गुप्ता'],
    ['चेनारी', 'नेहा कुमारी (नतराज)'],
    ['काराकट', 'रितेश रंजन (पांडेय)'],
    ['गोह', 'सीता राम दुबे'],
    ['नविनगर', 'अर्चना चंद्रा'],
    ['इमामगंज', 'डॉ. अजीत कुमार'],
    ['बोधगया', 'लक्ष्मण मांझी'],
    ['नौतन', 'संतोष चौधरी'],
    ['रक्सौल', 'कपिल देव प्रसाद उर्फ भुवन पटेल'],
    ['नरकटिया', 'लाल बाबू यादव'],
    ['केसरिया', 'नाज़ अहमद खान उर्फ पप्पू खान'],
    ['कल्याणपुर', 'डॉ. मंतोष साहनी'],
    ['चिरैया', 'संजय सिंह'],
    ['शिवहर', 'नीरज सिंह'],
    ['रीगा', 'कृष्ण मोहन'],
    ['बथनाहा', 'डॉ. नवल किशोर चौधरी'],
    ['बाजपट्टी', 'आज़म हुसैन अनवर'],
    ['सीतामढ़ी', 'जियाउद्दीन खान'],
    ['हरलाखी', 'रत्नेश्वर ठाकुर'],
    ['राजनगर', 'डॉ. सुरेंद्र कुमार दास'],
    ['झंझारपुर', 'केशव भंडारी'],
    ['पिपरा', 'इंद्रदेव साह'],
    ['त्रिवेणीगंज', 'प्रदीप राम'],
    ['नरपतगंज', 'जनार्दन यादव'],
    ['ठाकुरगंज', 'मो. एकरामुल हक'],
    ['कस्बा', 'इत्तेफाक आलम उर्फ मुन्ना'],
    ['बनमनखी', 'मनोज कुमार ऋषि'],
    ['रूपौली', 'आमोद कुमार'],
    ['कटिहार', 'डॉ. गाज़ी शारिक'],
    ['कदवा', 'मोहम्मद शहरयार'],
    ['बलरामपुर', 'असहाब आलम'],
    ['मनिहारी', 'बबलू सोरेन'],
    ['कोरहा', 'निर्मल कुमार राज'],
    ['सिंहेश्वर', 'प्रमोद कुमार राम'],
    ['मधेपुरा', 'शशि कुमार यादव'],
    ['सोनबर्षा', 'सत्येन्द्र हाजरा'],
    ['कुशेश्वर अस्थान', 'शत्रुधन पासवान'],
    ['गौरा बुरम', 'डॉ. इफ्तकार आलम'],
    ['बहादुरपुर', 'आमिर हैदर'],
    ['बड़हरिया', 'डॉ. शाहनवाज'],
    ['गोरियाकोठी', 'एजाज अहमद'],
    ['तरैया', 'सत्येन्द्र कुमार सहनी'],
    ['राजा पाकर', 'मुकेश कुमार राम'],
    ['महनार', 'डॉ. राजेश चौरसिया'],
    ['पटेपुर', 'दशई चौधरी'],
    ['वारिसनगर', 'सत्य नारायण उर्फ प्रदीप साहनी'],
    ['उजियारपुर', 'दुर्गा प्रसाद सिंह'],
    ['रोसेरा', 'रोहित पासवान'],
    ['हसनपुर', 'इंदु गुप्ता'],
    ['छेरियाबरियापुर', 'डॉ. मृत्युंजय'],
    ['बखरी', 'डॉ. संजय कुमार'],
    ['अलौली', 'अभिषेक कुमार'],
    ['कहलगांव', 'मंजर आलम'],
    ['भागलपुर', 'अभयकांत झा'],
    ['तारापुर', 'संतोष सिंह'],
    ['जमालपुर', 'लल्लन जी यादव'],
    ['सूर्याग्रह', 'अमित सागर'],
    ['इस्लामपुर', 'तनुजा कुमारी'],
    ['हरनौत', 'कमलेश पासवान'],
    ['बख्तियारपुर', 'बाल्मिकी सिंह'],
    ['फुलवारी', 'प्रो. शशिकांत प्रसाद'],
    ['मसौढ़ी', 'राजेश्वर मांझी'],
    ['संदेश', 'राजीव रंजन सिंह'],
    ['नोखा', 'डीएसपी नस्रुल्लाह खान'],
    ['कुटुंबा', 'श्याम बली राम उर्फ महाबली पासवान']
  ],
  'LJP': [
    ['गोविंदगंज', 'श्री राजू तिवारी'],
    ['सिमरी बख्तियारपुर', 'श्री संजय कुमार सिंह'],
    ['दरौली', 'श्री विष्णु देव पासवान'],
    ['गरखा', 'श्री सीमांत मुग्णाल'],
    ['साहेबपुर कमाल', 'श्री सुरेन्द्र कुमार'],
    ['बखरी', 'श्री संजय कुमार'],
    ['परबत्ता', 'श्री बाबूलाल शौर्य'],
    ['नाथनगर', 'श्री मिथुन कुमार'],
    ['पालीगंज', 'श्री सुनील कुमार'],
    ['ब्रह्मपुर', 'श्री हुलास पांडे'],
    ['डेहरी', 'श्री राजीव रंजन सिंह'],
    ['बलरामपुर', 'श्रीमती संगीता देवी'],
    ['मखदुमपुर', 'श्रीमती रानी कुमारी'],
    ['ओबरा', 'श्री प्रकाश चन्द्र'],
    ['सुगौली', 'श्री राजेश कुमार उर्फ बबलू गुप्ता'],
    ['बेलसंड', 'श्री अमित कुमार'],
    ['मढौरा', 'श्रीमती सीमा सिंह'],
    ['शेरघाटी', 'श्री उदय कुमार सिंह'],
    ['बोधगया', 'श्री श्यामदेव पासवान'],
    ['रजौली', 'श्री विमल राजवंशी'],
    ['गोविन्दपुर', 'श्रीमती बिनीता मेहता'],
    ['बोचहां', 'श्रीमती बेबी कुमारी'],
    ['बख्तियारपुर', 'श्री अरुण कुमार'],
    ['फतुहा', 'श्रीमती रूपा कुमारी'],
    ['बहादुरगंज', 'मो0 कलीमुद्दीन'],
    ['महुआ', 'श्री संजय कुमार सिंह'],
    ['चेनारी', 'श्री मुरारी प्रसाद गौतम'],
    ['मनेर', 'श्री जीतेन्द्र यादव'],
    ['कसबा', 'श्री नितेश कुमार सिंह']
  ],
  'HAM': [
    ['इमामगंज', 'श्रीमती दीपा कुमारी'],
    ['टिकारी', 'श्री अनिल कुमार'],
    ['बाराचट्टी', 'श्रीमती ज्योति देवी'],
    ['अतरी', 'श्री रोमित कुमार'],
    ['सिकंदरा', 'श्री प्रफुल्ल कुमार मांझी'],
    ['कुटुंबा', 'श्री ललन राम']
  ],
  'RLM': [
    ['बाजपट्टी', 'श्री रामेश्वर कुमार महतो'],
    ['मधुबनी', 'श्री माधव आनंद'],
    ['पारू', 'श्री मदन चौधरी'],
    ['उजियारपुर', 'श्री प्रशांत कुमार पंकज'],
    ['सासाराम', 'श्रीमती रेखलता'],
    ['दिनारा', 'श्री आलोक कुमार सिंह']
  ]
};

async function backupDatabase() {
  console.log('\n📦 Creating backup of current candidate data...');
  try {
    const [candidates] = await db.query('SELECT * FROM Candidates');
    const backupFile = path.join(__dirname, `candidates_backup_${Date.now()}.json`);
    fs.writeFileSync(backupFile, JSON.stringify(candidates, null, 2));
    console.log(`✓ Backup saved to: ${backupFile}`);
    console.log(`  Total candidates backed up: ${candidates.length}`);
    return true;
  } catch (error) {
    console.error('✗ Backup failed:', error.message);
    return false;
  }
}

async function deleteAllCandidates() {
  console.log('\n🗑️  Deleting all existing candidates...');
  try {
    const [result] = await db.query('DELETE FROM Candidates');
    console.log(`✓ Deleted ${result.affectedRows} candidates`);
    return true;
  } catch (error) {
    console.error('✗ Delete failed:', error.message);
    return false;
  }
}

async function getPartyId(partyCode) {
  try {
    // Map party codes to database short_code
    const codeMap = {
      'BJP': 'BJP',
      'JDU': 'JDU',
      'JAN_SURAJ': 'JAN_SURAJ',
      'LJP': 'LJPRV', // Lok Janshakti Party (Ram Vilas)
      'HAM': 'HAMS',  // Hindustani Awam Morcha (Secular)
      'RLM': 'RLM'
    };
    
    const mappedCode = codeMap[partyCode] || partyCode;
    const [rows] = await db.query('SELECT id FROM Parties WHERE short_code = ?', [mappedCode]);
    if (rows.length > 0) {
      return rows[0].id;
    }
    console.error(`✗ Party not found: ${partyCode} (mapped to: ${mappedCode})`);
    return null;
  } catch (error) {
    console.error(`✗ Error getting party ID for ${partyCode}:`, error.message);
    return null;
  }
}

async function getConstituencyId(constituencyName) {
  try {
    // Name mapping for CSV to Database mismatches
    const nameMapping = {
      'गौरा-बौराम': 'गौरा बौराम',
      'गौरा बुरम': 'गौरा बौराम',
      'बैकुण्ठपुर': 'बैकुंठपुर',
      'सिवान': 'सीवान',
      'गोरेयाकोठी': 'गोरियाकोठी',
      'बछवारा': 'बछवाड़ा',
      'तेघरा': 'तेघड़ा',
      'बड़हरा': 'बरहरा',
      'गया शहर': 'गया टाउन',
      'वारसलीगंज': 'वारिसलीगंज',
      'हयाघाट': 'हायाघाट',
      'बायसी': 'बैसी',
      'मोहनीया': 'मोहनिया',
      'कुशेश्वरस्थान': 'कुशेश्वर स्थान',
      'कुशेश्वर अस्थान': 'कुशेश्वर स्थान',
      'बड़हरिया': 'बरहरिया',
      'महराजगंज': 'महाराजगंज',
      'राजापाकर': 'राजा पाकर',
      'सराय रंजन': 'सरायरंजन',
      'चेरिया बरियारपुर': 'चेरिया-बरियारपुर',
      'नालन्दा': 'नालंदा',
      'सुरसंड': 'सुरसन्ड',
      'हरनाखी': 'हरलाखी',
      'अमीर': 'अमौर',
      'बराड़ी': 'बरारी',
      'कराहर': 'करगहर',
      'कुरथी': 'कुटुंबा',
      'नवीनगर': 'नबीनगर',
      'नविनगर': 'नबीनगर',
      'बेलानगर': 'बेलागंज',
      'आलमनगर': 'आलम नगर',
      'दरौंधा': 'दरौंदा',
      'मंझी': 'मांझी',
      'बिहार शरीफ': 'बिहारशरीफ',
      'काराकट': 'काराकाट',
      'बोधगया': 'बोध गया',
      'रुन्नीसैदपुर': 'रून्नीसैदपुर',
      'कोरहा': 'कोढ़ा',
      'सोनबर्षा': 'सोनबरसा',
      'पटेपुर': 'पातेपुर',
      'रोसेरा': 'रोसड़ा',
      'छेरियाबरियापुर': 'चेरिया-बरियारपुर',
      'सूर्याग्रह': 'सूर्यगढ़ा',
      'गोविंदगंज': 'गोविन्दगंज',
      'रजौली': 'राजौली',
      'गोविन्दपुर': 'गोबिन्दपुर',
      'कसबा': 'कस्बा',
      'वाल्मीकि नगर': 'वाल्मीकिनगर'
    };
    
    // Remove SC/ST markers and extra spaces
    let cleanName = constituencyName
      .replace(/\s*\(अ\.जा\.\)/g, '')
      .replace(/\s*\(अ\.ज\.जा\.\)/g, '')
      .replace(/\s*\(SC\)/g, '')
      .replace(/\s*\(ST\)/g, '')
      .replace(/\s*\(अनु\.जाति\)/g, '')
      .replace(/\s*\(अनुसूचित जाति\)/g, '')
      .trim();
    
    // Apply name mapping
    if (nameMapping[cleanName]) {
      cleanName = nameMapping[cleanName];
    }
    
    const [rows] = await db.query(
      'SELECT id FROM Constituencies WHERE name_hindi = ? OR name_hindi LIKE ?',
      [cleanName, `${cleanName}%`]
    );
    
    if (rows.length > 0) {
      return rows[0].id;
    }
    
    console.warn(`⚠ Constituency not found: ${constituencyName} (cleaned: ${cleanName})`);
    return null;
  } catch (error) {
    console.error(`✗ Error getting constituency ID for ${constituencyName}:`, error.message);
    return null;
  }
}

async function importCandidates() {
  console.log('\n📥 Importing candidates from CSV data...');
  
  let totalImported = 0;
  let totalSkipped = 0;
  
  for (const [partyCode, candidates] of Object.entries(csvData)) {
    console.log(`\n📋 Processing ${partyCode} (${candidates.length} candidates)...`);
    
    const partyId = await getPartyId(partyCode);
    if (!partyId) {
      console.error(`✗ Skipping ${partyCode} - party not found in database`);
      totalSkipped += candidates.length;
      continue;
    }
    
    let imported = 0;
    let skipped = 0;
    
    for (const [constituencyName, candidateName] of candidates) {
      const constituencyId = await getConstituencyId(constituencyName);
      
      if (!constituencyId) {
        console.warn(`  ⚠ Skipping: ${candidateName} (${constituencyName})`);
        skipped++;
        continue;
      }
      
      try {
        await db.query(
          `INSERT INTO Candidates (name_hindi, party_id, constituency_id, created_at) 
           VALUES (?, ?, ?, NOW())`,
          [candidateName, partyId, constituencyId]
        );
        imported++;
        
        if (imported % 10 === 0) {
          process.stdout.write(`  ✓ ${imported}/${candidates.length}...\r`);
        }
      } catch (error) {
        console.error(`  ✗ Failed to insert ${candidateName}:`, error.message);
        skipped++;
      }
    }
    
    console.log(`  ✓ Imported: ${imported}, Skipped: ${skipped}`);
    totalImported += imported;
    totalSkipped += skipped;
  }
  
  console.log(`\n✅ Import complete!`);
  console.log(`  Total imported: ${totalImported}`);
  console.log(`  Total skipped: ${totalSkipped}`);
  
  return true;
}

async function verifyCandidates() {
  console.log('\n🔍 Verifying imported data...');
  
  try {
    // Count by party
    const [partyCounts] = await db.query(`
      SELECT p.name_hindi, p.short_code, COUNT(c.id) as count 
      FROM Parties p 
      LEFT JOIN Candidates c ON p.id = c.party_id 
      GROUP BY p.id, p.name_hindi, p.short_code
      ORDER BY count DESC
    `);
    
    console.log('\n📊 Candidates by party:');
    for (const row of partyCounts) {
      if (row.count > 0) {
        console.log(`  ${row.name_hindi} (${row.short_code}): ${row.count}`);
      }
    }
    
    // Total count
    const [total] = await db.query('SELECT COUNT(*) as count FROM Candidates');
    console.log(`\n📈 Total candidates in database: ${total[0].count}`);
    
    // Sample records
    const [samples] = await db.query(`
      SELECT c.name_hindi, p.name_hindi as party, con.name_hindi as constituency
      FROM Candidates c
      JOIN Parties p ON c.party_id = p.id
      JOIN Constituencies con ON c.constituency_id = con.id
      LIMIT 5
    `);
    
    console.log('\n📝 Sample records:');
    for (const sample of samples) {
      console.log(`  ${sample.name_hindi} (${sample.party}) - ${sample.constituency}`);
    }
    
    return true;
  } catch (error) {
    console.error('✗ Verification failed:', error.message);
    return false;
  }
}

async function main() {
  console.log('🚀 Starting candidate data import process...');
  
  try {
    // Step 1: Backup
    const backupSuccess = await backupDatabase();
    if (!backupSuccess) {
      console.error('\n❌ Backup failed. Aborting import for safety.');
      process.exit(1);
    }
    
    // Step 2: Delete all existing candidates
    const deleteSuccess = await deleteAllCandidates();
    if (!deleteSuccess) {
      console.error('\n❌ Delete operation failed. Aborting.');
      process.exit(1);
    }
    
    // Step 3: Import new candidates
    const importSuccess = await importCandidates();
    if (!importSuccess) {
      console.error('\n❌ Import failed.');
      process.exit(1);
    }
    
    // Step 4: Verify
    await verifyCandidates();
    
    console.log('\n✅ All operations completed successfully!');
    process.exit(0);
    
  } catch (error) {
    console.error('\n❌ Fatal error:', error);
    process.exit(1);
  }
}

main();
